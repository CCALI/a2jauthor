<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
	CALI Author 5 / A2J Author 5 (CAJA)
	All Contents Copyright The Center for Computer-Assisted Legal Instruction
-->
<HTML  >
<head>
	 
<link href="../viewer/viewer.jquery-ui.css" rel="stylesheet" type="text/css" />
<link href="../viewer/jquery-ui.extra.css"  rel="stylesheet" type="text/css" title="style" />
<link href="../viewer/A2J_Viewer.css" rel="stylesheet" type="text/css" />
<script src="../viewer/jquery.1.8.2.min.js" type="text/javascript"></script>
<script src="../viewer/jquery.ui.1.9.1.min.js" type="text/javascript"></script>

<style type="text/css"> 

.bar {
	position: relative;
}
#uploadAnswerFileInput {
	opacity:  0;
	position: absolute;
	left: 0;
	height: 30px;
}
</style>

 
<script type='text/javascript'> 
// 05/2014 Test Client side Answer file load/save


$(document).ready(function()
{
	$('#uploadAnswer').button();
	$('#downloadAnswer').button().click(function(){answerFileDownload()});
	$('#uploadAnswerFileInput').on('change',answerFileUpload);
});

function answerFileUpload()
{	// Browse for answer file to upload to client (no server).
	var file = $('#uploadAnswerFileInput')[0].files[0];
	var textType = /text.*/;
	$('#answer').text("Loading..."); 
	if (file.type=='' || file.type.match(textType)) 
	{
		var reader = new FileReader();
		reader.onload = function(e)
		{
			$('#answer').val(reader.result);
		}

		reader.readAsText(file);	
	} 
	else
	{
		$('#answer').val("File not supported!"); 
	}
}
function answerFileDownload()
{	// Download answer file directly from client.
	var a =  window.document.createElement('a');
	var txt = $('#answer').val();
	//alert(txt);
	a.href = window.URL.createObjectURL(new Blob([txt], {type: 'application/octet-stream'}));
	a.download = 'answer.anx';
	// Append anchor to body.
	document.body.appendChild(a)
	a.click();
	// Remove anchor from body
	document.body.removeChild(a)
}

</script>
<title>File Load/Save</title></head><BODY>

<div class="a2jv">
<h1>Client side load/save answer file</h1>

<div class="bar">
<button id="uploadAnswer">Open</button> <input type="file" id="uploadAnswerFileInput"> 
<button id="downloadAnswer">Save</button>
</div>

<p>Answer file:</p>
<p>
	<textarea name="answer" id="answer" cols="45" rows="15"></textarea>
</p>

<script>

/*
function download(filename, text) {
    var pom = document.createElement('a');
    pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    pom.setAttribute('download', filename);
    pom.click();
}
//download('test.txt', 'Hello world!'); 
	$('#dl2').on('click',function(event) {
//		downloadFile();
		window.open(
		'http://authordev.a2jauthor.org/app/js/viewer/blank_answerset.anx',
		//'../Viewer/blank_answerset.xml',
		 '_self'
		 //'_blank'
		 );
	});
window.downloadFile = function() {
// Works only in Chrome or Safari, not FireFox.
	var filename='test.txt';
	var text='This is some test text';
	var newA = window.document.createElement("a"); 
	newA.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
	newA.setAttribute('download', filename);
//	alert(newA);
	newA.click();	 
}
function saveAnswer()
{
	var filename='test.txt';
	var text='This is some test text';
	$(this).attr({
		'href': 'data:text/plain;charset=utf-8,' + encodeURIComponent(text),
		'target': '_blank'
	});
};
 
    function createDownloadLink(anchorSelector, str, fileName){
        if(window.navigator.msSaveOrOpenBlob) {
            var fileData = [str];
            blobObject = new Blob(fileData);
            $(anchorSelector).click(function(){
                window.navigator.msSaveOrOpenBlob(blobObject, fileName);
            });
        } else {
            var url = "data:text/plain;charset=utf-8," + encodeURIComponent(str);
            $(anchorSelector).attr("download", fileName);               
            $(anchorSelector).attr("href", url);
        }
    }

    $(function () {
        var str = "hi,file";
        createDownloadLink("#export",str,"file.txt");
    });

*/
</script>



</div>

</BODY>
</HTML>
